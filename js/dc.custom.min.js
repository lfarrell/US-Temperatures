d3.csv("world/all.csv",function(b){var e=d3.time.format("%m/%Y").parse,c="#4575b4 #91bfdb #e0f3f8 #fee090 #fc8d59 #d73027".split(" "),f=document.body.clientWidth/2-80,d;d=document.querySelectorAll(".tooltip").length?d3.select(".tooltip"):d3.select("body").append("div").attr("class","tooltip").style("opacity",0);b.forEach(function(b){b.date=e(b.date);b.month=d3.time.month(b.date).getMonth();b.year=d3.time.year(b.date).getFullYear();b.anomaly=+b.anomaly});d3.csv("us_all.csv",function(g){g.forEach(function(a){a.date=e(a.date);a.month=d3.time.month(a.date).getMonth();a.year=d3.time.year(a.date).getFullYear();a.value=+a.value;a.anomaly=+a.anomaly});var h=crossfilter(b),k=crossfilter(g),l=dc.heatMap("#us_heat"),m=dc.heatMap("#world_heat"),k=k.dimension(function(a){return[+a.month,+a.year]}),h=h.dimension(function(a){return[+a.month,+a.year]});l.width(f).height(1775).margins({top:0,right:20,bottom:100,left:60}).dimension(k).group({all:function(){return grouping(g)}}).xBorderRadius(0).yBorderRadius(0).keyAccessor(function(a){return+a.key[0]}).valueAccessor(function(a){return+a.key[1]}).colorAccessor(function(a){return+a.value}).colors(c).calculateColorDomain().on("renderlet",function(a){d3.selectAll("#us_heat g.cols text").each(function(a){var b=d3.select(this);b.text(months(a));a=b.attr("y");b.attr("y",parseInt(a)-50)});d3.selectAll("#us_heat .box-group").on("mouseover",function(a){a="Date: "+months(a.key[0])+", "+a.key[1]+"<br/>Temperature: "+a.temp+" degrees (F)<br/>Anomaly: "+a.value+" degrees (F)";d.transition().duration(200).style("opacity",.9);d.html(a).style("top",d3.event.pageY+38+"px").style("left",d3.event.pageX-38+"px")}).on("mouseout",function(){d.transition().duration(500).style("opacity",0)})});l.render();m.width(f).height(1775).margins({top:0,right:20,bottom:100,left:60}).dimension(h).group({all:function(){return grouping(b)}}).xBorderRadius(0).yBorderRadius(0).keyAccessor(function(a){return+a.key[0]}).valueAccessor(function(a){return+a.key[1]}).colorAccessor(function(a){return+a.value}).colors(c).calculateColorDomain().on("renderlet",function(a){d3.selectAll("#world_heat g.cols text").each(function(a){var b=d3.select(this);b.text(months(a));a=b.attr("y");b.attr("y",parseInt(a)-50)});d3.selectAll("#world_heat .box-group").on("mouseover",function(a){a="Date: "+months(a.key[0])+", "+a.key[1]+"<br/>Anomaly: "+a.value+" degrees (F)";d.transition().duration(200).style("opacity",.9);d.html(a).style("top",d3.event.pageY+38+"px").style("left",d3.event.pageX-38+"px")}).on("mouseout",function(){d.transition().duration(500).style("opacity",0)})});m.render();d3.selectAll(".hide").classed("hide",!1);d3.select("#note").classed("hide",!0)})});function months(b){switch(b){case 0:return"Jan";case 1:return"Feb";case 2:return"Mar";case 3:return"Apr";case 4:return"May";case 5:return"Jun";case 6:return"Jul";case 7:return"Aug";case 8:return"Sep";case 9:return"Oct";case 10:return"Nov";case 11:return"Dec";default:return"unknown"}}function grouping(b){for(var e=[],c=0,f=b.length;c<f;c++)e.push({key:[b[c].month,b[c].year],temp:b[c].value,state:b[c].state,value:b[c].anomaly});return e};